{"version":3,"file":"taquito-streamer.es5.js","sources":["../src/taquito-streamer.ts"],"sourcesContent":["import WS from 'ws';\n\nconst DEFAULT_STREAMER_URL = 'wss://api.tez.ie/streamer/mainnet/subscribe';\n\nexport class Subscription {\n  private errorListeners: Array<(error: Error) => void> = [];\n  private messageListeners: Array<(data: string) => void> = [];\n  private closeListeners: Array<() => void> = [];\n\n  constructor(private readonly ws: WS) {\n    ws.onmessage = (event: WS.MessageEvent) => {\n      this.call(this.messageListeners, JSON.parse(event.data.toString()));\n    };\n    ws.onclose = (_event: WS.CloseEvent) => {\n      this.call(this.closeListeners);\n    };\n    ws.onerror = (event: WS.ErrorEvent) => {\n      this.call(this.messageListeners, event.error);\n    };\n  }\n\n  private call(listeners: Array<(val: any) => void>, value?: string | Error) {\n    for (const l of listeners) {\n      try {\n        l(value);\n      } catch (ex) {\n        console.error(ex);\n      }\n    }\n  }\n\n  private remove(listeners: Array<any>, value: any) {\n    const idx = listeners.indexOf(value);\n    if (idx !== -1) {\n      listeners.splice(idx, 1);\n    }\n  }\n\n  public on(type: 'error', cb: (error: Error) => void): void;\n  // tslint:disable-next-line: unified-signatures\n  public on(type: 'data', cb: (data: string) => void): void;\n  public on(type: 'close', cb: () => void): void;\n\n  public on(type: 'data' | 'error' | 'close', cb: any): void {\n    switch (type) {\n      case 'data':\n        this.messageListeners.push(cb);\n        break;\n      case 'error':\n        this.errorListeners.push(cb);\n        break;\n      case 'close':\n        this.closeListeners.push(cb);\n        break;\n      default:\n        throw new Error(`Trying to register on an unsupported event: ${type}`);\n    }\n  }\n\n  public off(type: 'error', cb: (error: Error) => void): void;\n  // tslint:disable-next-line: unified-signatures\n  public off(type: 'data', cb: (data: string) => void): void;\n  public off(type: 'close', cb: () => void): void;\n\n  public off(type: 'data' | 'error' | 'close', cb: any): void {\n    switch (type) {\n      case 'data':\n        this.remove(this.messageListeners, cb);\n        break;\n      case 'error':\n        this.remove(this.errorListeners, cb);\n        break;\n      case 'close':\n        this.remove(this.closeListeners, cb);\n        break;\n      default:\n        throw new Error(`Trying to unregister on an unsupported event: ${type}`);\n    }\n  }\n\n  public close() {\n    this.ws.close();\n  }\n}\n\nexport class StreamerProvider {\n  constructor(private url: string = DEFAULT_STREAMER_URL) {}\n\n  subscribe(_filter: 'head'): Subscription {\n    const ws = new WS(this.url);\n    return new Subscription(ws);\n  }\n}\n"],"names":[],"mappings":"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"}