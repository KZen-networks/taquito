{"version":3,"file":"taquito-streamer.umd.js","sources":["../src/taquito-streamer.ts"],"sourcesContent":["import WS from 'ws';\n\nconst DEFAULT_STREAMER_URL = 'wss://api.tez.ie/streamer/mainnet/subscribe';\n\nexport class Subscription {\n  private errorListeners: Array<(error: Error) => void> = [];\n  private messageListeners: Array<(data: string) => void> = [];\n  private closeListeners: Array<() => void> = [];\n\n  constructor(private readonly ws: WS) {\n    ws.onmessage = (event: WS.MessageEvent) => {\n      this.call(this.messageListeners, JSON.parse(event.data.toString()));\n    };\n    ws.onclose = (_event: WS.CloseEvent) => {\n      this.call(this.closeListeners);\n    };\n    ws.onerror = (event: WS.ErrorEvent) => {\n      this.call(this.messageListeners, event.error);\n    };\n  }\n\n  private call(listeners: Array<(val: any) => void>, value?: string | Error) {\n    for (const l of listeners) {\n      try {\n        l(value);\n      } catch (ex) {\n        console.error(ex);\n      }\n    }\n  }\n\n  private remove(listeners: Array<any>, value: any) {\n    const idx = listeners.indexOf(value);\n    if (idx !== -1) {\n      listeners.splice(idx, 1);\n    }\n  }\n\n  public on(type: 'error', cb: (error: Error) => void): void;\n  // tslint:disable-next-line: unified-signatures\n  public on(type: 'data', cb: (data: string) => void): void;\n  public on(type: 'close', cb: () => void): void;\n\n  public on(type: 'data' | 'error' | 'close', cb: any): void {\n    switch (type) {\n      case 'data':\n        this.messageListeners.push(cb);\n        break;\n      case 'error':\n        this.errorListeners.push(cb);\n        break;\n      case 'close':\n        this.closeListeners.push(cb);\n        break;\n      default:\n        throw new Error(`Trying to register on an unsupported event: ${type}`);\n    }\n  }\n\n  public off(type: 'error', cb: (error: Error) => void): void;\n  // tslint:disable-next-line: unified-signatures\n  public off(type: 'data', cb: (data: string) => void): void;\n  public off(type: 'close', cb: () => void): void;\n\n  public off(type: 'data' | 'error' | 'close', cb: any): void {\n    switch (type) {\n      case 'data':\n        this.remove(this.messageListeners, cb);\n        break;\n      case 'error':\n        this.remove(this.errorListeners, cb);\n        break;\n      case 'close':\n        this.remove(this.closeListeners, cb);\n        break;\n      default:\n        throw new Error(`Trying to unregister on an unsupported event: ${type}`);\n    }\n  }\n\n  public close() {\n    this.ws.close();\n  }\n}\n\nexport class StreamerProvider {\n  constructor(private url: string = DEFAULT_STREAMER_URL) {}\n\n  subscribe(_filter: 'head'): Subscription {\n    const ws = new WS(this.url);\n    return new Subscription(ws);\n  }\n}\n"],"names":[],"mappings":"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"}